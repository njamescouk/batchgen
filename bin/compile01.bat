@echo off
rem this file has been generated by batchgen and may be overwritten
rem command line: batchgen -orb compile.bg
rem date 2011-0-7 21:27:44

@goto main

:initialise

rem set DEBUG=<anything> gets a debug build
set DEBUG=
set VC_MAKE_HELP=
set ILLEGAL_OPT=
set CC_FLAGS=
set SOURCE_FILES=batchgen.c bkpatch.c fileread.c lex.yy.c optim.c sr.c stacks.c y.tab.c

rem edit these to suit
set CC=c:\bin\MinGW\bin\g++.exe
goto :eof


:getopts

rem while
:WH0
if not "%1" == "" goto WB0
goto EW0
:WB0
if "%1" == "-d" goto IF1
goto LS1
:IF1
 set DEBUG=True

goto EI1
rem else
:LS1
if "%1" == "-h" goto IF0
goto LS0
:IF0
set VC_MAKE_HELP=True

goto EI0
rem else
:LS0
set ILLEGAL_OPT=True
rem endif
:EI0
rem endif
:EI1
 shift 
goto WH0
rem endwhile
:EW0

goto :eof


:usage
echo usage vc_make [options]

echo options
echo     -d     include debugging code for lexer and parser
echo     -h     help
goto :eof

:main

call :initialise
call :getopts

if "%VC_MAKE_HELP%" == "True" goto IF4
goto ORF0
:ORF0
if "%ILLEGAL_OPT%" == "True" goto IF4
goto LS4
:IF4
 call :usage 
goto batch_end

goto EI4
rem else
:LS4
if "%DEBUG%" == "" goto IF2
goto LS2
:IF2

       call doLexYacc
       set CC_FLAGS=-D WIN32 -D NDEBUG -D _CONSOLE
       set YYDEBUG=
       

goto EI2
rem else
:LS2

       call doLexYacc -d
       set CC_FLAGS=-D WIN32 -D _CONSOLE -D DEBUG -D YYDEBUG
       set YYDEBUG=1
       
rem endif
:EI2

pushd I:\usr\NIK\dev\batchgen\source

markupgrammar -f batchgen.y > ..\doc\batchgen.y.html
markupgrammar -f batchgen.y -d > ..\doc\batchgen.y.dot
markupgrammar -f ..\source\batchgen.y -x > ..\doc\batchgen.y.docbook.xml

    @echo on

    %CC% %CC_FLAGS% %SOURCE_FILES%

    @echo off
    del *.obj
    
pushd I:\usr\NIK\dev\batchgen\doc
dot -O -Tpng batchgen.y.dot
popd


if "%DEBUG%" == "" goto IF3
goto LS3
:IF3

       copy batchgen.exe ..\bin

goto EI3
rem else
:LS3

       copy batchgen.exe ..\bin\batchgen_debug.exe
       
rem endif
:EI3
del batchgen.exe
rem endif
:EI4
popd
 @echo finished 
:batch_end
